<% set_meta_tags title: "投稿一覧", description: "みんなのアイデアを見てみよう！" %>
<h1><%= t("titles.post_idea_list") %></h1>

<ul>
  <% @posts.each do |post| %>
    <li class="mb-4 p-2 border rounded flex items-center gap-2">
      
      <!-- ユーザーアイコン -->
      <%= image_tag post.user.display_image,
            class: "rounded-full w-10 h-10 object-cover border shadow-md" %>

      <!-- 左側 本文エリア -->
      <div class="flex-1">

        <!-- ユーザー名 -->
        <p class="font-semibold text-blue-600">
          <%= link_to post.user.display_name, user_path(post.user), class: "hover:underline" %>
        </p>

        <!-- ジャンル + タグを横並びで -->
        <div class="mt-1 flex flex-wrap gap-1 items-center">

          <!-- ジャンルバッジ -->
          <%= link_to search_posts_path(q: { genre_id_eq: post.genre.id }),
              class: "px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200" do %>
            <%= post.genre.name %>
          <% end %>

          <!-- タグバッジ -->
          <% post.tags.each do |tag| %>
            <%= link_to posts_path(tag_id: tag.id),
                class: "px-2 py-1 bg-gray-200 text-gray-700 rounded text-xs hover:bg-gray-300" do %>
              #<%= tag.name %>
            <% end %>
          <% end %>
        </div>

        <!-- 投稿内容（本文） -->
        <%= link_to post.content, post_path(post),
              class: "block mt-1 text-gray-800 hover:underline" %>

      </div>

      <!-- 右側操作エリア -->
      <div class="flex items-center gap-2 ml-auto">

        <% if user_signed_in? && post.user == current_user %>
          <%= link_to t("buttons.edit"),
              edit_post_path(post, from: request.path),
              class: "px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm" %>

          <%= button_to t("buttons.destroy"),
              post_path(post),
              method: :delete,
              data: { confirm: "削除しますか？" },
              class: "px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm" %>
        <% end %>

        <!-- いいね -->
        <div id="like-button-<%= post.id %>">
          <%= render "likes/like", post: post %>
        </div>
      </div>

    </li>
  <% end %>
</ul>
